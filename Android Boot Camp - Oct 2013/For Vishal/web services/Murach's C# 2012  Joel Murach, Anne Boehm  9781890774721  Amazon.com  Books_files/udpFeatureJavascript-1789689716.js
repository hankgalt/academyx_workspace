P.register("swfobject",function(){var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;
if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;
if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;
X=false;
ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");
ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);
ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);
ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;
}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);
if(ad){ab=ad.GetVariable("$version");
if(ab){X=true;
ab=ab.split(" ")[1].split(",");
ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];
}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac};
}(),k=function(){if(!M.w3){return;
}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f();
}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false);
}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);
f();
}});
if(O==top){(function(){if(J){return;
}try{j.documentElement.doScroll("left");
}catch(X){setTimeout(arguments.callee,0);
return;
}f();
})();
}}if(M.wk){(function(){if(J){return;
}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);
return;
}f();
})();
}s(f);
}}();
function f(){if(J){return;
}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));
Z.parentNode.removeChild(Z);
}catch(aa){return;
}J=true;
var X=U.length;
for(var Y=0;
Y<X;
Y++){U[Y]();
}}function K(X){if(J){X();
}else{U[U.length]=X;
}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false);
}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false);
}else{if(typeof O.attachEvent!=D){i(O,"onload",Y);
}else{if(typeof O.onload=="function"){var X=O.onload;
O.onload=function(){X();
Y();
};
}else{O.onload=Y;
}}}}}function h(){if(T){V();
}else{H();
}}function V(){var X=j.getElementsByTagName("body")[0];
var aa=C(r);
aa.setAttribute("type",q);
var Z=X.appendChild(aa);
if(Z){var Y=0;
(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");
if(ab){ab=ab.split(" ")[1].split(",");
M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];
}}else{if(Y<10){Y++;
setTimeout(arguments.callee,10);
return;
}}X.removeChild(aa);
Z=null;
H();
})();
}else{H();
}}function H(){var ag=o.length;
if(ag>0){for(var af=0;
af<ag;
af++){var Y=o[af].id;
var ab=o[af].callbackFn;
var aa={success:false,id:Y};
if(M.pv[0]>0){var ae=c(Y);
if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);
if(ab){aa.success=true;
aa.ref=z(Y);
ab(aa);
}}else{if(o[af].expressInstall&&A()){var ai={};
ai.data=o[af].expressInstall;
ai.width=ae.getAttribute("width")||"0";
ai.height=ae.getAttribute("height")||"0";
if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class");
}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align");
}var ah={};
var X=ae.getElementsByTagName("param");
var ac=X.length;
for(var ad=0;
ad<ac;
ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value");
}}P(ai,ah,Y,ab);
}else{p(ae);
if(ab){ab(aa);
}}}}}else{w(Y,true);
if(ab){var Z=z(Y);
if(Z&&typeof Z.SetVariable!=D){aa.success=true;
aa.ref=Z;
}ab(aa);
}}}}}function z(aa){var X=null;
var Y=c(aa);
if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y;
}else{var Z=Y.getElementsByTagName(r)[0];
if(Z){X=Z;
}}}return X;
}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312);
}function P(aa,ab,X,Z){a=true;
E=Z||null;
B={success:false,id:X};
var ae=c(X);
if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);
Q=null;
}else{l=ae;
Q=X;
}aa.id=R;
if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310";
}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137";
}j.title=j.title.slice(0,47)+" - Flash Player Installation";
var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;
if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac;
}else{ab.flashvars=ac;
}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");
X+="SWFObjectNew";
Y.setAttribute("id",X);
ae.parentNode.insertBefore(Y,ae);
ae.style.display="none";
(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae);
}else{setTimeout(arguments.callee,10);
}})();
}u(aa,ab,X);
}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");
Y.parentNode.insertBefore(X,Y);
X.parentNode.replaceChild(g(Y),X);
Y.style.display="none";
(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y);
}else{setTimeout(arguments.callee,10);
}})();
}else{Y.parentNode.replaceChild(g(Y),Y);
}}function g(ab){var aa=C("div");
if(M.win&&M.ie){aa.innerHTML=ab.innerHTML;
}else{var Y=ab.getElementsByTagName(r)[0];
if(Y){var ad=Y.childNodes;
if(ad){var X=ad.length;
for(var Z=0;
Z<X;
Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true));
}}}}}return aa;
}function u(ai,ag,Y){var X,aa=c(Y);
if(M.wk&&M.wk<312){return X;
}if(aa){if(typeof ai.id==D){ai.id=Y;
}if(M.ie&&M.win){var ah="";
for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae];
}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"';
}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"';
}}}}}var af="";
for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />';
}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";
N[N.length]=ai.id;
X=c(ai.id);
}else{var Z=C(r);
Z.setAttribute("type",q);
for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac]);
}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac]);
}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab]);
}}aa.parentNode.replaceChild(Z,aa);
X=Z;
}}return X;
}function e(Z,X,Y){var aa=C("param");
aa.setAttribute("name",X);
aa.setAttribute("value",Y);
Z.appendChild(aa);
}function y(Y){var X=c(Y);
if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";
(function(){if(X.readyState==4){b(Y);
}else{setTimeout(arguments.callee,10);
}})();
}else{X.parentNode.removeChild(X);
}}}function b(Z){var Y=c(Z);
if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null;
}}Y.parentNode.removeChild(Y);
}}function c(Z){var X=null;
try{X=j.getElementById(Z);
}catch(Y){}return X;
}function C(X){return j.createElement(X);
}function i(Z,X,Y){Z.attachEvent(X,Y);
I[I.length]=[Z,X,Y];
}function F(Z){var Y=M.pv,X=Z.split(".");
X[0]=parseInt(X[0],10);
X[1]=parseInt(X[1],10)||0;
X[2]=parseInt(X[2],10)||0;
return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false;
}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return;
}var aa=j.getElementsByTagName("head")[0];
if(!aa){return;
}var X=(ad&&typeof ad=="string")?ad:"screen";
if(ab){n=null;
G=null;
}if(!n||G!=X){var Z=C("style");
Z.setAttribute("type","text/css");
Z.setAttribute("media",X);
n=aa.appendChild(Z);
if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1];
}G=X;
}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y);
}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"));
}}}function w(Z,X){if(!m){return;
}var Y=X?"visible":"hidden";
if(J&&c(Z)){c(Z).style.visibility=Y;
}else{v("#"+Z,"visibility:"+Y);
}}function L(Y){var Z=/[\\\"<>\.;]/;
var X=Z.exec(Y)!=null;
return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y;
}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;
for(var ab=0;
ab<ac;
ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2]);
}var Z=N.length;
for(var aa=0;
aa<Z;
aa++){y(N[aa]);
}for(var Y in M){M[Y]=null;
}M=null;
for(var X in swfobject){swfobject[X]=null;
}swfobject=null;
});
}}();
return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};
Y.id=ab;
Y.swfVersion=X;
Y.expressInstall=aa;
Y.callbackFn=Z;
o[o.length]=Y;
w(ab,false);
}else{if(Z){Z({success:false,id:ab});
}}},getObjectById:function(X){if(M.w3){return z(X);
}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};
if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);
K(function(){ae+="";
ag+="";
var aj={};
if(af&&typeof af===r){for(var al in af){aj[al]=af[al];
}}aj.data=ab;
aj.width=ae;
aj.height=ag;
var am={};
if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak];
}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai];
}else{am.flashvars=ai+"="+Z[ai];
}}}if(F(Y)){var an=u(aj,am,ah);
if(aj.id==ah){w(ah,true);
}X.success=true;
X.ref=an;
}else{if(aa&&A()){aj.data=aa;
P(aj,am,ah,ac);
return;
}else{w(ah,true);
}}if(ac){ac(X);
}});
}else{if(ac){ac(X);
}}},switchOffAutoHideShow:function(){m=false;
},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]};
},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X);
}else{return undefined;
}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y);
}},removeSWF:function(X){if(M.w3){y(X);
}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X);
}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;
if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1];
}if(aa==null){return L(Z);
}var Y=Z.split("&");
for(var X=0;
X<Y.length;
X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)));
}}}return"";
},expressInstallCallback:function(){if(a){var X=c(R);
if(X&&l){X.parentNode.replaceChild(l,X);
if(Q){w(Q,true);
if(M.ie&&M.win){l.style.display="block";
}}if(E){E(B);
}}a=false;
}}};
}();
return swfobject;
});
P.when("A","jQuery","swfobject").register("SampleAudioPlayer",function(A,$,swfobject){function SampleAudioPlayer(){var audioPlayer={},minFlashVersion="9.0.0";
function isHTML5AudioSupported(audioSrc){var audio=document.createElement("audio");
var audioProperties=getAudioFormatAndCodec(audioSrc);
var formatAndCodec=audioProperties.format+'; codecs="'+audioProperties.codec+'"';
var isHTML5AudioSupported=0;
if(audio&&audio.canPlayType&&audio.canPlayType(formatAndCodec)&&audio.canPlayType(formatAndCodec).replace(/no/,"")){isHTML5AudioSupported=1;
}return isHTML5AudioSupported;
}function getAudioFormatAndCodec(audioSrc){var result={};
var extension=audioSrc.match("[^.]+$");
if(extension.length>0){result.codec=extension[0];
if(result.codec=="mp3"){result.format="audio/mpeg";
}else{if(result.codec=="ogg"){result.format="audio/ogg";
}else{if(result.codec=="wav"){result.format="audio/wav";
}}}}return result;
}audioPlayer.init=function(options){if(typeof options.audioSrc!=="undefined"&&typeof options.audioId!=="undefined"&&typeof options.audioControllerId!=="undefined"){var isHTML5Supported=isHTML5AudioSupported(options.audioSrc);
if(isHTML5Supported){audioPlayer.player=new HTML5Player(options);
audioPlayer.player.initializePlayer(options);
audioPlayer.isPlayerAvailable=1;
}else{if(options.flashPlayerUrl&&swfobject&&swfobject.hasFlashPlayerVersion(minFlashVersion)){options.minFlashVersion=minFlashVersion;
audioPlayer.player=new FlashPlayer(options);
audioPlayer.player.initializePlayer(options);
audioPlayer.isPlayerAvailable=1;
}}}};
audioPlayer.pause=function(){if(typeof audioPlayer.player!=="undefined"){audioPlayer.player.pause();
}};
audioPlayer.play=function(){if(typeof audioPlayer.player!=="undefined"){audioPlayer.player.play();
}};
return audioPlayer;
}function HTML5Player(options){var player={};
function appendAudioMarkup(options){var audioMarkup=$('<audio id="'+options.audioId+'" src="'+options.audioSrc+'"></audio>');
options.audioControllerId.append(audioMarkup);
player.audioObj=$("#"+options.audioId).get(0);
player.audioId=$("#"+options.audioId);
}function addEventListeners(){player.audioObj.addEventListener("ended",audioEnded);
player.audioObj.addEventListener("playing",audioPlaying);
player.audioObj.addEventListener("pause",audioPaused);
player.audioObj.addEventListener("loadeddata",audioReady);
}function audioEnded(){player.audioId.trigger("audioEnded");
}function audioPlaying(){player.audioId.trigger("audioPlaying");
}function audioPaused(){player.audioId.trigger("audioPaused");
}function audioReady(){player.audioId.trigger("audioReady");
}player.initializePlayer=function(options){player.options=options;
player.isFirstPlay=1;
};
player.play=function(){if(player.isFirstPlay){appendAudioMarkup(player.options);
addEventListeners();
if(typeof options.bindEventsCallback=="function"){options.bindEventsCallback(player.audioId);
}player.isFirstPlay=0;
}player.audioObj.play();
};
player.pause=function(){player.audioObj.pause();
};
return player;
}function FlashPlayer(options){var player={};
if(!window.Mp3Interface){window.Mp3Interface={currentPlayer:null,setCurrentPlayer:function(requestingPlayer){if(requestingPlayer){if(Mp3Interface.currentPlayer&&Mp3Interface.currentPlayer.audioId!==requestingPlayer.audioId){swfobject.getObjectById(Mp3Interface.currentPlayer.audioId).stopSong();
Mp3Interface.currentPlayer.isPlaying=0;
}Mp3Interface.currentPlayer=requestingPlayer;
}},callback:function(event){if(Mp3Interface.currentPlayer){if(event=="onPlayerInit"){Mp3Interface.currentPlayer.audioId.trigger("audioReady");
}else{if(event=="onPlay"){Mp3Interface.currentPlayer.audioId.trigger("audioPlaying");
Mp3Interface.currentPlayer.isPlaying=1;
}else{if(event=="onPause"){Mp3Interface.currentPlayer.audioId.trigger("audioPaused");
Mp3Interface.currentPlayer.isPlaying=0;
}else{if(event=="onComplete"){Mp3Interface.currentPlayer.audioId.trigger("audioEnded");
Mp3Interface.currentPlayer.isPlaying=0;
Mp3Interface.currentPlayer.isFirstPlay=1;
}}}}}}};
}function embedFlashPlayer(options){options.audioControllerId.append('<div id="'+options.audioId+'"></div>');
var swfURL=options.flashPlayerUrl,mp3PlayerElemId=options.audioId,playerWidth=1,playerHeight=1,minFlashVersion=options.minFlashVersion,expressInstallSwfurl=null,flashVars={protocol:window.location.protocol.replace(":","")},params={allowScriptAccess:"always"};
swfobject.embedSWF(swfURL,mp3PlayerElemId,playerHeight,playerWidth,minFlashVersion,expressInstallSwfurl,flashVars,params);
}player.initializePlayer=function(options){player.isFirstPlay=1;
player.options=options;
Mp3Interface.setCurrentPlayer(this);
embedFlashPlayer(options);
player.audioId=$("#"+options.audioId);
if(typeof options.bindEventsCallback=="function"){options.bindEventsCallback(player.audioId);
}player.isPlaying=0;
};
player.play=function(){if(!player.isPlaying){Mp3Interface.setCurrentPlayer(this);
if(player.isFirstPlay){swfobject.getObjectById(player.options.audioId).playSong(options.audioSrc);
player.isFirstPlay=0;
}else{swfobject.getObjectById(player.options.audioId).pauseSong();
}}};
player.pause=function(){if(player.isPlaying){Mp3Interface.setCurrentPlayer(this);
swfobject.getObjectById(player.options.audioId).pauseSong();
}};
return player;
}return SampleAudioPlayer;
});
P.when("A","jQuery","ImageBlockATF","SampleAudioPlayer","cf").execute(function(A,$,imageBlockData,AudioPlayer){var imageBlock=$("#imageBlock"),imgWrapper=imageBlock.find("#img-wrapper"),imgContainer=imageBlock.find("#imageBlockContainer"),canvas=imageBlock.find("#img-canvas"),backImage=canvas.find(".backImage"),sideImage=canvas.find(".sideImage"),frontImage=canvas.find(".frontImage"),flipToBack=imageBlock.find(".flipImageToBack"),sampleAudio=imageBlock.find(".sampleBookAudio"),is3dAvailable=0,bookState="front",isShowing3D=0,isAudioPlaying=0,audioListen=sampleAudio.find(".audioListenText"),audioPlaying=sampleAudio.find(".audioPlayingText"),audioPaused=sampleAudio.find(".audioPausedText"),audioText=sampleAudio.find(".audioText"),audioPopoverTrigger=sampleAudio.find(".audioPopoverTrigger"),audioId="img-blk-audio-sample",audioPlayer,flipToBackText=flipToBack.find(".flipToBackText"),flipToFrontText=flipToBack.find(".flipToFrontText"),flipToBackImg=flipToBack.find(".flipToBackImg"),isIE=isIEBrowser(),popoverObj,DPCL,ftbLoggingcompleted=0,ftfLoggingcompleted=0,audioLoggingCompleted=0,leftCol=$("#leftCol"),centerCol=$("#centerCol"),sideTranslation=0;
amznJQ.available("DPClientLogger",function(){if(typeof window.DPClientLogger!="undefined"){DPCL=new window.DPClientLogger.ImpressionLogger("dpbxapps","bxapps-atfMarker",true,true);
}});
setupInteractions();
function setupInteractions(){fixCanvas();
if(imageBlockData.audibleData&&imageBlockData.audibleData.audioSampleSrc){initializeAudioPlayer();
}is3dAvailable=is3dSupported();
isShowing3D=is3dAvailable&&typeof backImage!=="undefined"&&backImage.length>0;
if(isShowing3D){var frontWidth=frontImage.width(),frontHeight=frontImage.height();
if(frontWidth>0&&frontHeight>0){canvas.addClass("image-3d");
backImage.css("width",frontWidth).css("height",frontHeight);
sideImage.css("height",frontHeight);
if(isIE){showIE3dExperience();
}else{showFront3dExperience();
showBack3dExperience();
}audioPlayer&&audioPlayer.isPlayerAvailable?flipToBack.addClass("a-span6"):flipToBack.addClass("a-span12");
A.declarative("flip-action",["click","mouseenter","mouseleave"],flipImage);
}if(DPCL){DPCL.logImpression("ma-books-image-ftb-shown");
}}else{canvas.addClass("image-2d");
}if(imageBlockData&&imageBlockData.litbData&&imageBlockData.litbData.hasLitb&&imageBlockData.litbData.litbReftag){canvas.click(addLitb);
}if(audioPlayer&&audioPlayer.isPlayerAvailable){addAudioLink();
if(DPCL){DPCL.logImpression("ma-books-image-listen-shown");
}}$(window).resize(resizeCallback);
}function resizeCallback(){var w=window.innerWidth||document.body.offsetWidth;
if(w<=0){return;
}if(w>imageBlockData.windowWidthThreshold&&imageBlock.width()<=imageBlockData.configWidths[0]){var newWidth=imageBlockData.configWidths[1],newHeight=newWidth/imageBlockData.holderRatio,canvasWidth=imageBlockData.frontImageWidth,canvasHeight=imageBlockData.frontImageHeight;
resizeImageBlock(newWidth,newHeight,canvasWidth,canvasHeight);
}else{if(w<imageBlockData.windowWidthThreshold&&imageBlock.width()>imageBlockData.configWidths[0]){var newWidth=imageBlockData.configWidths[0],newHeight=newWidth/imageBlockData.holderRatio,canvasWidth,canvasHeight;
if(imageBlockData.frontImageAspectRatio>imageBlockData.holderRatio){canvasWidth=newWidth;
canvasHeight=canvasWidth/imageBlockData.frontImageAspectRatio;
}else{canvasHeight=newHeight;
canvasWidth=canvasHeight*imageBlockData.frontImageAspectRatio;
}resizeImageBlock(newWidth,newHeight,canvasWidth,canvasHeight);
}}}function resizeImageBlock(newWidth,newHeight,canvasWidth,canvasHeight){if(newWidth>0&&newHeight>0&&canvasWidth>0&&canvasHeight>0){centerCol.css("margin-left",newWidth+imageBlockData.centerColMargin).removeClass("centerColumn");
leftCol.css("width",newWidth);
var newImgBlkHeight=newHeight+imageBlockData.containerMargin+imageBlockData.flipLinkMinHeight;
imageBlock.css("width",newWidth).css("height",newImgBlkHeight);
resizeCanvasAndImage(canvasWidth,canvasHeight);
imgContainer.css("height",newHeight-(newHeight-frontImage.outerHeight())/2);
canvas.css("top",imgContainer.outerHeight()-frontImage.outerHeight()).css("left",(imgContainer.outerWidth()-frontImage.outerWidth())/2);
$(this).trigger("imageResize");
audioPopoverHide();
}}function resizeCanvasAndImage(width,height){frontImage.css("width",width).css("height",height);
var frontWidth=frontImage.width(),frontHeight=frontImage.height();
canvas.css("width",frontWidth).css("height",frontHeight);
if(typeof backImage!=="undefined"&&backImage.length>0){backImage.css("width",frontWidth).css("height",frontHeight);
sideImage.css("height",frontHeight);
if(isShowing3D&&isIE){var sideWidth=sideImage.width();
sideTranslation=(frontWidth-sideWidth)/2-2;
sideImage.removeClass("ieTransition").css("left",(frontWidth-sideWidth)/2);
if(bookState=="front"){sideImage.css("transform","perspective(3000px) rotateY(-65deg) translateZ("+sideTranslation+"px)");
}else{sideImage.css("transform","perspective(3000px) rotateY(90deg) translateZ("+sideTranslation+"px)");
}A.delay(function(){sideImage.addClass("ieTransition");
},10);
}}}function initializeAudioPopover(){var popoverContent=sampleAudio.find(".audioSamplePopover");
amznJQ.available("popover",function(){popoverObj=audioPopoverTrigger.amazonPopoverTrigger({title:null,showOnHover:false,width:null,location:"right",closeText:null,zIndex:991,showCloseButton:true,localContent:popoverContent,attached:true,controlCallbacks:true,align:"middle",locationOffset:[20,10]});
});
audioListen.click(audioPopoverShow);
}function audioPopoverShow(){if(popoverObj&&!popoverObj.amznPopoverVisible()){audioPopoverTrigger.click();
}}function audioPopoverHide(){if(popoverObj&&popoverObj.amznPopoverVisible()){popoverObj.amznPopoverHide();
}}function initializeAudioPlayer(){audioPlayer=new AudioPlayer();
var options={};
options.audioSrc=imageBlockData.audibleData.audioSampleSrc;
options.audioId=audioId;
options.audioControllerId=sampleAudio;
options.flashPlayerUrl=imageBlockData.audibleData.flashPlayerUrl;
options.bindEventsCallback=bindAudioEvents;
audioPlayer.init(options);
}function bindAudioEvents(audioObjId){audioObjId.bind("audioEnded",function(){audioPaused.hide();
audioPlaying.hide();
audioListen.show();
isAudioPlaying=0;
audioPopoverHide();
});
audioObjId.bind("audioPlaying",function(){audioPaused.hide();
audioListen.hide();
audioPlaying.show();
isAudioPlaying=1;
audioPopoverShow();
});
audioObjId.bind("audioPaused",function(){audioPlaying.hide();
audioListen.hide();
audioPaused.show();
isAudioPlaying=0;
audioPopoverHide();
});
}function addAudioLink(){isShowing3D?sampleAudio.addClass("a-span6"):sampleAudio.addClass("a-span12");
audioPlaying.hide();
audioPaused.hide();
sampleAudio.removeClass("a-hidden");
audioText.children().click(controlPlayback);
var audioTextWidth=parseInt(getAudioTextWidth());
if(audioTextWidth&&audioTextWidth>0){audioText.css("width",audioTextWidth);
}initializeAudioPopover();
}function getAudioTextWidth(){var listenWidth=audioListen.outerWidth(),playingWidth=audioPlaying.outerWidth(),pausedWidth=audioPaused.outerWidth(),widthBuffer=5,width=0;
if(listenWidth>0&&playingWidth>0&&pausedWidth>0){width=Math.max(listenWidth,playingWidth,pausedWidth)+widthBuffer;
}return width;
}function controlPlayback(){if(DPCL&&!audioLoggingCompleted){DPCL.logImpression("ma-books-image-listen");
audioLoggingCompleted=1;
}if(isAudioPlaying){audioPlayer.pause();
}else{audioPlayer.play();
}}function addLitb(event){if(typeof(SitbReader)!="undefined"){if(bookState=="back"&&SitbReader.currentBook&&SitbReader.currentBook.bookmarks){var backCoverPageNum=SitbReader.currentBook.bookmarks.getFirstAndLastPageNumberByName("Back Cover").first,backFlapPageNum=SitbReader.currentBook.bookmarks.getFirstAndLastPageNumberByName("Back Flap").first;
if(backCoverPageNum){SitbReader.LightboxActions.openReaderToPage(backCoverPageNum);
}else{if(backFlapPageNum){SitbReader.LightboxActions.openReaderToPage(backFlapPageNum);
}else{SitbReader.LightboxActions.openReader(imageBlockData.litbData.litbReftag);
}}}else{SitbReader.LightboxActions.openReader(imageBlockData.litbData.litbReftag);
}}}function flipImage(event){if(isIE){if(event.type=="click"){if(bookState=="front"){bookState="back";
frontImage.removeClass("frontUnrotated frontUnrotatedHover").addClass("frontRotated");
backImage.removeClass("backUnrotated backUnrotatedHover").addClass("backRotated");
sideImage.css("transform","perspective(3000px) rotateY(90deg) translateZ("+sideTranslation+"px)");
flipToBackText.addClass("a-hidden");
flipToFrontText.removeClass("a-hidden");
flipToBackImg.addClass("flipToBackImgRotate");
if(DPCL&&!ftbLoggingcompleted){DPCL.logImpression("ma-books-image-ftb");
ftbLoggingcompleted=1;
}}else{bookState="front";
frontImage.removeClass("frontRotated frontRotatedHover").addClass("frontUnrotated");
backImage.removeClass("backRotated backRotatedHover").addClass("backUnrotated");
sideImage.css("transform","perspective(3000px) rotateY(-65deg) translateZ("+sideTranslation+"px)");
flipToFrontText.addClass("a-hidden");
flipToBackText.removeClass("a-hidden");
flipToBackImg.removeClass("flipToBackImgRotate");
if(DPCL&&!ftfLoggingcompleted){DPCL.logImpression("ma-books-image-ftf");
ftfLoggingcompleted=1;
}}}else{if(event.type=="mouseenter"){if(bookState=="front"){frontImage.removeClass("frontUnrotated").addClass("frontUnrotatedHover");
backImage.removeClass("backUnrotated").addClass("backUnrotatedHover");
sideImage.css("transform","perspective(3000px) rotateY(-55deg) translateZ("+sideTranslation+"px)");
}else{frontImage.removeClass("frontRotated").addClass("frontRotatedHover");
backImage.removeClass("backRotated").addClass("backRotatedHover");
sideImage.css("transform","perspective(3000px) rotateY(80deg) translateZ("+sideTranslation+"px)");
}}else{if(bookState=="front"){frontImage.removeClass("frontUnrotatedHover").addClass("frontUnrotated");
backImage.removeClass("backUnrotatedHover").addClass("backUnrotated");
sideImage.css("transform","perspective(3000px) rotateY(-65deg) translateZ("+sideTranslation+"px)");
}else{frontImage.removeClass("frontRotatedHover").addClass("frontRotated");
backImage.removeClass("backRotatedHover").addClass("backRotated");
sideImage.css("transform","perspective(3000px) rotateY(90deg) translateZ("+sideTranslation+"px)");
}}}}else{if(event.type=="click"){if(bookState=="front"){canvas.removeClass("bookCanvasTransformHover").addClass("rotated");
flipToBackText.addClass("a-hidden");
flipToFrontText.removeClass("a-hidden");
flipToBackImg.addClass("flipToBackImgRotate");
bookState="back";
if(DPCL&&!ftbLoggingcompleted){DPCL.logImpression("ma-books-image-ftb");
ftbLoggingcompleted=1;
}}else{canvas.removeClass("rotated rotatedHover");
flipToFrontText.addClass("a-hidden");
flipToBackText.removeClass("a-hidden");
flipToBackImg.removeClass("flipToBackImgRotate");
bookState="front";
if(DPCL&&!ftfLoggingcompleted){DPCL.logImpression("ma-books-image-ftf");
ftfLoggingcompleted=1;
}}}else{if(event.type=="mouseenter"){if(bookState=="front"){canvas.addClass("bookCanvasTransformHover");
}else{canvas.removeClass("rotated").addClass("rotatedHover");
}}else{if(bookState=="front"){canvas.removeClass("bookCanvasTransformHover");
}else{canvas.removeClass("rotatedHover").addClass("rotated");
}}}}}function fixCanvas(){var wrapperPos=imgWrapper.offset(),frontImgPos=frontImage.offset(),canvasTop=frontImgPos.top-wrapperPos.top,canvasLeft=frontImgPos.left-wrapperPos.left,canvasWidth=frontImage.outerWidth(),canvasHeight=frontImage.outerHeight(),newImgBlkHeight=imgWrapper.outerHeight()-(imgWrapper.outerHeight()-frontImage.outerHeight())/2,sideWidth=sideImage.outerWidth();
imgWrapper.css("position","relative");
canvas.css("position","absolute").css("top",canvasTop).css("left",canvasLeft).css("width",canvasWidth).css("height",canvasHeight);
frontImage.css("position","absolute").css("top","0").css("left","0");
backImage.css("position","absolute").css("top","0").css("left","0");
sideImage.css("position","absolute").css("top","0").css("left","-"+sideWidth+"px");
imgContainer.css("height",newImgBlkHeight);
}function showFront3dExperience(){imgWrapper.addClass("parentImage");
sideImage.addClass("bookSpine").removeClass("a-hidden");
canvas.addClass("bookCanvasTransition");
frontImage.addClass("bookFrontTransition");
A.delay(function(){canvas.addClass("bookCanvasTransformHover");
A.delay(function(){canvas.removeClass("bookCanvasTransformHover");
},1500);
},50);
}function showBack3dExperience(){backImage.addClass("bookBack").removeClass("a-hidden");
flipToBack.removeClass("a-hidden");
}function is3dSupported(){var isSupported=1,props=["Perspective","TransformStyle","TransformOrigin","BackfaceVisibility","Transition"];
for(var i=0;
i<props.length;
i++){isSupported=isSupported&&isCSSPropertySupported(props[i]);
}return isSupported;
}function showIE3dExperience(){var sideWidth=sideImage.outerWidth(),frontWidth=frontImage.outerWidth();
sideTranslation=(frontWidth-sideWidth)/2-2;
sideImage.css("left",(frontWidth-sideWidth)/2).css("transform","perspective(3000px) rotateY(-90deg) translateZ("+sideTranslation+"px)");
frontImage.addClass("ieTransition ieBookShadow").css("transform-origin","50% 50% -"+sideWidth/2+"px");
backImage.addClass("ieTransition backLanding ieBookShadow").removeClass("a-hidden").css("transform-origin","50% 50% -"+sideWidth/2+"px");
sideImage.addClass("ieTransition ieBookShadow").removeClass("a-hidden").css("transform-origin","50% 50% -"+sideWidth/2+"px");
A.delay(function(){backImage.removeClass("backLanding").addClass("backUnrotated");
frontImage.addClass("frontUnrotated");
sideImage.css("transform","perspective(3000px) rotateY(-65deg) translateZ("+sideTranslation+"px)");
},50);
frontImage.mouseenter(function(){sideImage.css("transform","perspective(3000px) rotateY(-75deg) translateZ("+sideTranslation+"px)");
});
frontImage.mouseleave(function(){sideImage.css("transform","perspective(3000px) rotateY(-65deg) translateZ("+sideTranslation+"px)");
});
flipToBack.removeClass("a-hidden");
}function isCSSPropertySupported(prop){var domPrefixes=["Webkit","Moz","O","ms"],div=document.createElement("div"),support=false;
for(var i=0;
i<domPrefixes.length;
i++){if(domPrefixes[i]+prop in div.style){support=support||true;
}}if(prop==="Perspective"&&"WebkitPerspective" in div.style){support=false;
div.id="test3d";
document.body.appendChild(div);
if(div.offsetHeight===3){support=true;
}div.parentNode.removeChild(div);
}return support;
}function isIEBrowser(){return $.browser.msie;
}});
P.when("A","jQuery","atf").execute(function(A,$,atf){$("#byline .showMoreLink").click(function(){$("#byline .author").each(function(){if(!$(this).hasClass("notFaded")){$(this).addClass("notFaded").fadeIn(0);
}$("#byline .more").removeClass("notFaded").fadeOut(0);
});
return false;
});
$("#byline .contributorNameID").mouseenter(function(){var asin=$(this).attr("data-asin");
var params={};
var ajaxComplete="isAjaxComplete_"+asin;
var ajaxInProgress="isAjaxInProgress_"+asin;
var stateData=A.state("popoverImage-state");
params["entityID"]=asin;
if(!(stateData[ajaxComplete]==="1")&&!(stateData[ajaxInProgress]==="1")){$.ajax({url:"/gp/product/utility/by-line/book-contributor-details/ajax/author-image.html",data:params,dataType:"html",timeout:1000,success:function(html){$("#contributorImageContainer"+asin).get(0).innerHTML=html;
stateData[ajaxComplete]="1";
A.state("popoverImage-state",stateData);
},error:function(){stateData[ajaxInProgress]="0";
A.state("popoverImage-state",stateData);
}});
stateData[ajaxInProgress]="1";
A.state("popoverImage-state",stateData);
}});
function resizeByline(){var bylineWidth=parseInt($("#byline").width());
var visibleAuthorsWidth=0;
$("#byline .author").each(function(){if($(this).is(".notFaded")){visibleAuthorsWidth+=$(this).outerWidth();
}});
visibleAuthorsWidth+=$("#byline .more").outerWidth();
if(visibleAuthorsWidth>bylineWidth){var totalDisplayedAuthors=$("#byline .author.notFaded").length;
$($("#byline .author.notFaded").get().reverse()).each(function(index){if(visibleAuthorsWidth>bylineWidth&&index<(totalDisplayedAuthors-1)){var currentWidth=$(this).width();
$(this).removeClass("notFaded");
$(this).fadeOut(10,function(){$(this).hide();
});
visibleAuthorsWidth=visibleAuthorsWidth-currentWidth;
$("#byline .moreCount").html($("#byline .author").length-$("#byline .author.notFaded").length);
$("#byline .more").addClass("notFaded").fadeIn(10);
}});
}else{if(visibleAuthorsWidth<bylineWidth){if($("#byline .author.notFaded").length<$("#byline .author").length){var availableWidth=bylineWidth-visibleAuthorsWidth;
$("#byline .author").each(function(){if($(this).hasClass("notFaded")){}else{var currentWidth=$(this).outerWidth();
if(currentWidth<=availableWidth){availableWidth=availableWidth-currentWidth;
$(this).addClass("notFaded").fadeIn(10);
var andMore=$("#byline .author").length-$("#byline .author.notFaded").length;
if(andMore===0){$("#byline .more").removeClass("notFaded").fadeOut(10);
}else{$("#byline .moreCount").html(andMore);
$("#byline .more").addClass("notFaded").fadeIn(10);
}}else{availableWidth=0;
}}});
}}}}function responsiveByline(byline){var bylineWidth=parseInt(byline.width());
var moreWidth=parseInt(byline.find(".more").outerWidth());
var visibleAuthorsWidth=0;
$("#byline .author").each(function(){if($(this).is(".notFaded")){visibleAuthorsWidth+=$(this).outerWidth();
}});
$("#byline .more").attr("data-width",moreWidth);
var availableWidth=bylineWidth-moreWidth;
var defaultDisplayedAuthors=3;
if(availableWidth>visibleAuthorsWidth){byline.find(".author").each(function(){var currentIndex=$(this).index();
if(parseInt(currentIndex)>=parseInt(defaultDisplayedAuthors)){var thisWidth=$(this).outerWidth();
$(this).attr("data-width",thisWidth);
if(thisWidth<availableWidth){availableWidth=availableWidth-thisWidth;
$(this).addClass("notFaded");
$(this).fadeIn("slow");
}else{availableWidth=0;
$(this).fadeOut("slow");
}}else{var thisWidth=$(this).outerWidth();
$(this).attr("data-width",thisWidth);
availableWidth=availableWidth-thisWidth;
}});
}else{var totalDisplayedAuthors=$("#byline .author.notFaded").length;
$($("#byline .author.notFaded").get().reverse()).each(function(index){if(availableWidth<visibleAuthorsWidth&&index<(totalDisplayedAuthors-1)){var thisWidth=$(this).outerWidth();
visibleAuthorsWidth=visibleAuthorsWidth-thisWidth;
$(this).fadeOut("slow").removeClass("notFaded");
}else{}});
}var remainingNumber=byline.find(".author").length-byline.find(".author.notFaded").length;
if(remainingNumber>0){byline.find(".moreCount").html(remainingNumber);
byline.find(".more").fadeIn("slow");
byline.find(".more").addClass("notFaded");
}else{}}responsiveByline(A.$("#byline"));
$(window).resize(function(){resizeByline();
});
});
P.when("A","jQuery","atf").execute(function(A,$,atf){var rbbContainer=$("#rbbContainer");
rbbContainer.find(".rbbHeaderLink").attr("href","javascript:void(0);");
rbbContainer.find(".rbbHeader .displayNone i.prime").hide();
rbbContainer.find(".rbbHeader .displayNone .primeBadge").hide();
rbbContainer.find(".rbbHeader .ubbPrimeBadge").hide();
rbbContainer.find(".rbbHeader .prime-plus-price").hide();
rbbContainer.find(".rbbHeader .displayNone").removeClass("displayNone");
$("#rbbContainer .rbbSection.unselected .dp-accordion-inner").hide();
$("#rbbContainer .rbbSection .rbbHeader").click(function(e){var target=$(e.target);
var t=$(this);
var header=t.hasClass("rbbHeader")?t:t.parents(".rbbHeader");
if(header.parents(".rbbSection").hasClass("selected")){return false;
}rbbContainer.find(".selected .a-icon-radio-active").removeClass("a-icon-radio-active").addClass("a-icon-radio-inactive");
rbbContainer.find(".selected .offer-price").removeClass("a-color-price a-size-medium").addClass("a-color-base a-size-base");
rbbContainer.find("i.a-icon.prime").hide();
rbbContainer.find(".primeBadge").hide();
rbbContainer.find(".ubbPrimeBadge").hide();
var primePrice=rbbContainer.find(".prime-plus-price-grid");
if(primePrice.hasClass("hidden")){primePrice.removeClass("hidden").show();
}else{primePrice.addClass("hidden").hide();
}rbbContainer.find(".prime-plus-price").show();
header.parents(".rbbSection").removeClass("unselected").addClass("selected");
header.parents(".rbbSection").toggleClass("dp-accordion-active",500);
header.find(".a-icon-radio-inactive").removeClass("a-icon-radio-inactive").addClass("a-icon-radio-active");
header.find(".offer-price").removeClass("a-color-base a-size-base").addClass("a-color-price a-size-medium");
header.find("i.a-icon.prime").show();
header.find(".primeBadge").show();
header.find(".prime-plus-price").hide();
$("#rbbContainer .rbbSection .rbbContent").find(".offer-price").removeClass("a-color-base").addClass("a-color-price");
header.find(".ubbPrimeBadge").show();
var bbClicked=$(this).attr("id");
var slideMeDown,slideMeUp;
rbbContainer.find(".rbbSection").each(function(i,bb){if($(bb).find(".rbbHeader")[0].id==bbClicked){slideMeDown=$(bb);
}else{if($(bb).hasClass("selected")){slideMeUp=$(bb);
}}});
slideMeUp.find(".rbbContent").slideUp(500,function(){slideMeUp.removeClass("selected").addClass("unselected");
slideMeUp.toggleClass("dp-accordion-active",500);
});
slideMeDown.find(".rbbContent").slideDown(500);
if($.browser.msie&&parseInt($.browser.version,10)==7){slideMeDown.find(".rbbContent").css("display","inline");
setTimeout(function(){slideMeDown.find(".rbbContent").css("display","block");
},505);
}return true;
});
var bbop=$("#bbop");
var data={ASIN:bbop.attr("data-ASIN"),merchantID:bbop.attr("data-merchantID")};
var bbopBox=$("#bbopAndCartBox");
$.get("/gp/product/du/bbop-ajax-endpoint.html",data,function(result){if($.trim(result)=="1"){if(bbopBox){bbopBox.addClass("a-spacing-small a-color-offset-background bbopCartBoxBorder");
}bbop.removeClass("a-hidden");
if($.browser.msie&&parseInt($.browser.version,10)==7){setTimeout(function(){bbop.parent(".rbbContent").css("display","block");
},5);
}}});
amznJQ.onReady("popover",function(){var bbop=$("#bbop");
var checkbox=bbop.find("#bbop-check-box");
var atc=$("#add-to-cart-button");
var atcName=atc.attr("name");
bbop.find("a.prime-details").amazonPopoverTrigger({hoverHideDelay:200,hoverShowDelay:200,localContent:"#primePopoverContent",location:"left",showCloseButton:true,title:"&nbsp;",width:460,onHide:function(){try{amznJQ.available("ClientEventLogger",function(){ClientEventLogger.logActionCode("ac1");
});
}catch(e){}}});
checkbox.change(function(){var newAtcName=checkbox.is(":checked")?"submit.add-to-cart-prime-buy-box.x":atcName;
atc.attr("name",newAtcName);
});
});
$("#one-click-button, #one-click-button-ubb").click(function(){var hbbAction="https://"+window.location.host+$("#addToCart").attr("action");
$("#addToCart").attr("action",hbbAction);
return true;
});
});
P.when("A","jQuery","atf").execute(function(A,$,atf){var DPCL;
var rankDetailsLoggingCompleted=0;
amznJQ.available("DPClientLogger",function(){if(typeof window.DPClientLogger!="undefined"){DPCL=new window.DPClientLogger.ImpressionLogger("dpbxapps","bxapps-atfMarker",true,true);
}});
$("#bookDetails_feature_div .hero-more").click(function(e){e.preventDefault();
var detailID=$(this).attr("data-popupID");
var detail=$("#"+detailID);
var detailCenter=$(this).offset().left+$(this).width()/2;
var popoverPosition=$("#popupContent").offset().left;
var pointerCenter=detailCenter-popoverPosition;
var pointerPosition=(pointerCenter/($("#popupContent").width()))*100;
$("#"+detailID+" .pointer").css({"left":pointerPosition+"%"});
if($("#popupContent .details-popup").filter(":visible").length){if($("#popupContent .details-popup").filter(":visible").attr("id")!==detailID){$("#popupContent .details-popup").filter(":visible").slideToggle(300);
detail.slideToggle(300);
}else{detail.slideUp(300);
}}else{detail.slideDown(300);
if($(this).hasClass("hero-more")){$("html,body").animate({scrollTop:$("#bookDetails_feature_div").offset().top-50},600);
}}if(DPCL&&!rankDetailsLoggingCompleted){DPCL.logImpression("ma-books-br-details");
rankDetailsLoggingCompleted=1;
}});
$("#bookDetails_feature_div .moreNarratorLink").click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")||location.hostname==this.hostname){var target=$(this.hash);
target=target.length?target:$("[name="+this.hash.slice(1)+"]");
if(target.length){$("html,body").animate({scrollTop:target.offset().top},1000);
}return false;
}});
$("#bookDetails_feature_div .details-popup button").click(function(e){$(this).parent().slideUp(300);
});
});
P.when("A","jQuery","atf").execute(function(A,$){A.on.ready(enableMediaMatrixSupport);
function enableMediaMatrixSupport(){var loggingCompleted=0;
var DPCL;
amznJQ.available("DPClientLogger",function(){if(typeof window.DPClientLogger!="undefined"){DPCL=new window.DPClientLogger.ImpressionLogger("dpbxapps","bxapps-atfMarker",true,true);
}});
A.declarative("tmm-see-more-editions-click",["click"],tmmSeeMoreEditions);
$("#formats > .a-link-expander").click(function(){var divToUpdate="#twister";
var showPromptDiv="#showMoreFormatsPrompt";
var hidePromptDiv="#hideMoreFormatsPrompt";
var iconDiv="#formatsIcon";
var swatchesDiv="#tmmSwatches";
toggleShowHidePrompts(swatchesDiv,divToUpdate,showPromptDiv,hidePromptDiv,iconDiv);
if(DPCL&&$(divToUpdate).is(":visible")&&!loggingCompleted){DPCL.logImpression("tmm-show-more-formats-viewed");
loggingCompleted=1;
}});
function tmmSeeMoreEditions(event){var eventData=event.data;
var linkUrl=eventData["metabindingUrl"];
if(!event.$target.hasClass("a-link-expander")&&!event.$target.parent().hasClass("a-link-expander")){if(linkUrl!=="#"){window.location=linkUrl;
}return;
}var index=eventData["metabindingPlaceHolder"];
var topDivToUpdate="#metabinding_row_top_"+index;
var bottomDivToUpdate="#metabinding_row_bottom_"+index;
var seePromptDiv="#editionsSeePrompt_"+index;
var hidePromptDiv="#editionsHidePrompt_"+index;
var editionsIconDiv="#editionsIcon_"+index;
var ajaxStateData="isAjaxComplete_"+index;
var ajaxInProgress="isAjaxInProgress_"+index;
var loadingDiv="#tmmSpinnerDiv_"+index;
var tmmErrorDiv="#tmmErrorDiv_"+index;
var stateData=A.state("mediamatrix-state");
var url=stateData["url_"+index].replace(/&amp;/g,"&");
$("#formats .tmmErrorClass").hide();
if(stateData[ajaxStateData]==="1"||stateData[ajaxInProgress]==="1"){toggleShowHidePrompts(topDivToUpdate,bottomDivToUpdate,seePromptDiv,hidePromptDiv,editionsIconDiv);
}else{A.ajax(url,{method:"get",success:function(){stateData[ajaxStateData]="1";
A.state("mediamatrix-state",stateData);
toggleShowHidePrompts(topDivToUpdate,bottomDivToUpdate,seePromptDiv,hidePromptDiv,editionsIconDiv);
},indicator:$(loadingDiv),error:function(){$($tmmErrorDiv).show();
stateData[ajaxInProgress]="0";
A.state("mediamatrix-state",stateData);
}});
stateData[ajaxInProgress]="1";
A.state("mediamatrix-state",stateData);
}}function toggleShowHidePrompts(topContentDiv,bottomContentDiv,showDiv,hideDiv,iconDiv){$(topContentDiv).slideToggle(300);
$(bottomContentDiv).slideToggle(300);
$(showDiv).toggleClass("tmmShowPrompt tmmHidePrompt");
$(hideDiv).toggleClass("tmmShowPrompt tmmHidePrompt");
$(iconDiv).toggleClass("rotate");
}function responsiveDisplay(section){var childClass="swatchElement";
var sectionRightEdge=section.position().left+section.width()-2;
var numChildren=$("."+childClass).length;
section.find("."+childClass).each(function(){$(this).attr("data-width",$(this).width());
});
$("#formats").find(".a-row").removeClass("nonJSFormats");
}function responsiveFormats(){var tmmFormats=$("#formats");
var containerWidth=tmmFormats.width()-40;
var visibleFormatsWidth=0;
tmmFormats.find(".swatchElement").each(function(){if($(this).is(":visible")){visibleFormatsWidth+=$(this).width();
}});
if(visibleFormatsWidth>containerWidth){$(tmmFormats.find(".swatchElement:visible").get().reverse()).each(function(){var currentWidth=0;
var hiddenAlready=false;
if(!$(this).find(".format").hasClass("a-button-selected")){currentWidth=$(this).width();
hiddenAlready=$(this).is(":hidden");
$(this).hide();
}else{currentWidth=$(this).prev(".swatchElement").width();
hiddenAlready=$(this).prev(".swatchElement").is(":hidden");
$(this).prev(".swatchElement").hide();
}if(!hiddenAlready){visibleFormatsWidth=visibleFormatsWidth-currentWidth;
}return(visibleFormatsWidth>containerWidth);
});
}else{if(visibleFormatsWidth<containerWidth){tmmFormats.find(".swatchElement").each(function(){if($(this).is(":hidden")){var currentWidth=$(this).attr("data-width");
if(currentWidth<=containerWidth-visibleFormatsWidth){$(this).show();
}return false;
}});
}}}$("#formats.responsive").each(function(){responsiveDisplay($(this));
});
responsiveFormats();
A.on("resize",responsiveFormats);
$("#formats .unselected .format").mouseenter(function(){$(this).find(".a-color-secondary").addClass("a-color-price").removeClass("a-color-secondary");
}).mouseleave(function(){$(this).find(".a-color-price").addClass("a-color-secondary").removeClass("a-color-price");
});
}});
P.when("A","jQuery").execute(function(A,$){$("#one-click-button-ubb, #usedbuyBox #add-to-cart-button-ubb").click(function(){var addToCart=$("#addToCart");
var ubbAction=addToCart.attr("action").replace("ref=dp_start-bbf_1_glance","ref=dp_start-ubbf_1_glance");
addToCart.attr("action",ubbAction);
return true;
});
amznJQ.available("popover",function(){$("#usedItemConditionInfoLink").amazonPopoverTrigger({showCloseButton:false,closeEventInclude:["CLICK_TRIGGER","CLICK_OUTSIDE","MOUSE_LEAVE"],locationElement:$("#usedItemConditionInfoLink"),location:"bottom",width:250,localContent:"#usedItemConditionInfoPopover"});
});
});
P.when("A","jQuery","atf").execute(function(A,$,atf){if(!$("#bookDescription_feature_div").length){return;
}var bookDescriptionAvailableHeight=calculateBookDescriptionHeight();
var psTotalHeight=$("#postBodyPS").height();
if(psTotalHeight>bookDescriptionAvailableHeight+30){$("#outer_postBodyPS").show();
$("#outer_postBodyPS").css("height",bookDescriptionAvailableHeight);
$("#psPlaceHolder").show();
$("#expandPS").show();
$("#collapsePS").hide();
}else{$("#outer_postBodyPS").css("height","auto");
$("#psPlaceHolder").hide();
}var DPCL;
var readMoreLoggingCompleted=0;
var readLessLoggingCompleted=0;
amznJQ.available("DPClientLogger",function(){if(typeof window.DPClientLogger!="undefined"){DPCL=new window.DPClientLogger.ImpressionLogger("dpbxapps","bxapps-atfMarker",true,true);
}});
$("#bookDescription_feature_div .a-link-expander").click(function(){var divToUpdate="#outer_postBodyPS";
var showPromptDiv="#bdSeeAllPrompt";
var hidePromptDiv="#bdSeeLessPrompt";
var iconDiv="#bdExpanderIcon";
var partialDiv="#postBodyPS";
toggleBookDescriptionExpander(divToUpdate,showPromptDiv,hidePromptDiv,iconDiv,partialDiv);
return false;
});
function toggleBookDescriptionExpander(contentDiv,showDiv,hideDiv,iconDiv,partialDiv){if($(showDiv).is(":hidden")){var bookDescriptionAvailableHeight=calculateBookDescriptionHeight();
$(contentDiv).animate({height:bookDescriptionAvailableHeight},500);
$(showDiv).show();
$(hideDiv).hide();
$(iconDiv).toggleClass("rotate");
if(DPCL&&!readLessLoggingCompleted){DPCL.logImpression("ma-books-bd-rl");
readLessLoggingCompleted=1;
}}else{$(contentDiv).animate({height:$(partialDiv).height()},500);
$(showDiv).hide();
$(hideDiv).show();
$(iconDiv).toggleClass("rotate");
if(DPCL&&!readMoreLoggingCompleted){DPCL.logImpression("ma-books-bd-rm");
readMoreLoggingCompleted=1;
}}}function calculateBookDescriptionHeight(){var bdOffsetTop=$("#bookDescription_feature_div").offset().top;
var imageBlockOffsetTop=$("#booksImageBlock_feature_div").offset().top;
var imageBlockHeight=$("#booksImageBlock_feature_div").height();
var minBookDescriptionInitialHeight=112;
var bookDescriptionInitialHeight=imageBlockOffsetTop+imageBlockHeight-bdOffsetTop-30;
if(bookDescriptionInitialHeight<minBookDescriptionInitialHeight){bookDescriptionInitialHeight=minBookDescriptionInitialHeight;
}return bookDescriptionInitialHeight;
}});
P.when("A","jQuery","DynamicIframe","ProductDescriptionData","cf").execute(function(A,$,dynamicIframe,productDescriptionData){var encodedReviews=productDescriptionData.encodedReviews,reviewsPerRow=parseInt(productDescriptionData.reviewsPerRow),reviewsProcessed=0,restRowsProcessed=0,productDesc=$("#productDescription-multiColumn"),iframeDataHash={},partialIframeHeight=140,partialIframeHeightBuffer=30,reviewsExpander,seeMoreReviews,seeMoreReviewsState;
if(productDesc.length>0&&encodedReviews&&encodedReviews.length>0&&reviewsPerRow){reviewsExpander=productDesc.find(".reviewsExpander"),seeMoreReviews=productDesc.find(".seeMoreProductReviews"),initializeReviews();
}function initializeReviews(){initializeFirstRow();
initializeSeeMoreReviews();
}function initializeFirstRow(){reviewsProcessed=0;
var start=0,end=Math.min(reviewsPerRow,encodedReviews.length);
addReviews(start,end);
}function initializeSeeMoreReviews(){if(reviewsExpander.length>0&&seeMoreReviews.length>0){seeMoreReviewsState="collapsed";
reviewsExpander.removeClass("a-hidden");
reviewsExpander.click(function(){if(seeMoreReviewsState==="collapsed"){if(!restRowsProcessed){seeMoreReviews.removeClass("extraReviews");
var start=reviewsProcessed,end=encodedReviews.length;
addReviews(start,end);
restRowsProcessed=1;
}else{seeMoreReviews.animate({height:"show"});
}reviewsExpander.removeClass("collapsed").addClass("expanded");
seeMoreReviewsState="expanded";
}else{seeMoreReviews.animate({height:"hide"});
reviewsExpander.removeClass("expanded").addClass("collapsed");
seeMoreReviewsState="collapsed";
}});
}}function addReviews(from,to){var i;
for(i=from;
i<to;
i++){var options={};
options.iframeId="er_iframe_"+i;
options.iframeWrapperId="er_iframe_wrapper_"+i;
options.iframeContainerId="er_container_"+i;
options.iframeExpanderId="er_expander_"+i;
options.iframeColumnId="er_column_"+i;
options.encodedIframeContent=getEncodedIframeContent(encodedReviews[i]);
options.initialResizeCallback=setInitialIframeHeight;
var currentIframeData=setIframeData(options);
iframeDataHash[options.iframeId]=currentIframeData;
currentIframeData.column.removeClass("extraReviews");
createIframe(currentIframeData);
bindIframeEvents(currentIframeData);
reviewsProcessed++;
}}function setInitialIframeHeight(iframeId){var iframeData=iframeDataHash[iframeId];
if(iframeData&&iframeData.wrapper.outerHeight()>partialIframeHeight+partialIframeHeightBuffer){iframeData.container.css("height",partialIframeHeight);
iframeData.expander.removeClass("a-hidden expanded").addClass("collapsed");
iframeData.state="partial";
}}function setIframeData(options){var iframeData={};
iframeData["id"]=$("#"+options.iframeId);
iframeData["column"]=$("#"+options.iframeColumnId);
iframeData["wrapper"]=$("#"+options.iframeWrapperId);
iframeData["container"]=$("#"+options.iframeContainerId);
iframeData["expander"]=$("#"+options.iframeExpanderId);
iframeData["iframeObj"]=new dynamicIframe(options);
iframeData["state"]="full";
return iframeData;
}function resizeCallback(iframeId){var iframeData=iframeDataHash[iframeId];
if(iframeData&&iframeData.state==="full"){iframeData.container.css("height",iframeData.wrapper.outerHeight());
}}function bindIframeEvents(iframeData){if(iframeData&&typeof iframeData.iframeObj!="undefined"&&typeof iframeData.iframeObj.resizeIframe=="function"){A.on("resize",function(){iframeData.iframeObj.resizeIframe(resizeCallback);
});
}if(iframeData&&iframeData.expander){iframeData.expander.click(function(){if(iframeData.state==="partial"){iframeData.container.animate({height:iframeData.wrapper.outerHeight()});
iframeData.expander.removeClass("collapsed").addClass("expanded");
iframeData.state="full";
}else{iframeData.container.animate({height:partialIframeHeight});
iframeData.expander.removeClass("expanded").addClass("collapsed");
$("html, body").animate({scrollTop:iframeData.container.offset().top-20});
iframeData.state="partial";
}});
}}function createIframe(iframeData){if(iframeData&&typeof iframeData.iframeObj!="undefined"&&typeof iframeData.iframeObj.createIframe=="function"){iframeData.iframeObj.createIframe();
}}function getEncodedIframeContent(encodedReview){var content="<h3 class='erSource'>"+encodedReview.source+"</h3>"+"<div class='erContent'>"+encodedReview.content+"</div>";
if(encodedReview.footnote){content=content+"<em class='erFootnote'>"+encodedReview.footnote+"</em>";
}return content;
}});
P.when("A","jQuery","ImageBlockATF","ImageGalleryMarkup").execute(function(A,$,imageBlockData){var content=$("#imgGalleryContent"),popoverWrapper=content.closest(".a-popover-wrapper"),header=popoverWrapper.find(".a-popover-header"),contentWrapper=popoverWrapper.find(".a-popover-inner"),imageInner=content.find("#igInner"),image=imageInner.find("#igImage"),thumbs=content.find(".ig-thumbs"),mainImage=content.find(".ig-main-image"),loadingBar=content.find(".loading-bar"),height=0,defaultSelectedId="ig-thumb-0",images=null,numThumbs=0,zoomer=new ImageZoomer(),DPCL,galleryOpenLogged=0,thumbInteractionLogged=0;
amznJQ.available("DPClientLogger",function(){if(typeof window.DPClientLogger!="undefined"){DPCL=new window.DPClientLogger.ImpressionLogger("dpbxapps","bxapps-atfMarker",true,true);
}});
initializeGallery();
function initializeGallery(){if(content.length>0){loadingBar.hide();
extractImageData();
intializeContent();
bindThumbEvents();
}if(DPCL&&!galleryOpenLogged){DPCL.logImpression("ma-img-gallery-opened");
galleryOpenLogged=1;
}}function extractImageData(){var imageData=imageBlockData.imageGalleryData;
if(imageData&&imageData.length>0){images={};
numThumbs=imageData.length;
for(var i=0;
i<imageData.length;
i++){images["ig-thumb-"+i]=imageData[i];
}}}function intializeContent(){if(popoverWrapper.length>0){height=popoverWrapper.height();
if(header.length>0){height=height-header.height();
}if($.browser.msie&&$.browser.version==7){var wrapperPadding=contentWrapper.outerHeight()-contentWrapper.height();
if(wrapperPadding&&wrapperPadding>0){height=height-wrapperPadding;
}}if(height&&height>0){contentWrapper.css("height",height);
var contentHeight=mainImage.height();
var contentWidth=mainImage.width();
imageInner.css("height",contentHeight).css("width",contentWidth);
}updateImage(defaultSelectedId);
addThumbs(defaultSelectedId);
zoomOptions=getZoomOptions(defaultSelectedId);
zoomer.setImageData(zoomOptions);
zoomer.attachZoomEvents();
}}function addThumbs(selectedId){if(numThumbs>0){for(var i=0;
i<numThumbs;
i++){var thumbId="ig-thumb-"+i,selected=thumbId==selectedId?"selected":"";
var thumbMarkup=$('<div class="ig-thumb-image"><img class="ig-thumb-inner '+selected+'" id="'+thumbId+'" src="'+images[thumbId].thumbUrl+'"></div>');
thumbs.append(thumbMarkup);
}}}function updateImage(selectedId){if(images[selectedId]){var width=images[selectedId].dimensions[0],height=images[selectedId].dimensions[1],url=images[selectedId].mainUrl;
image.css("max-width",width).css("max-height",height).removeClass("image-stretch-horizontal image-stretch-vertical");
image.addClass(getImageFitClass(width,height));
image.attr("src",url);
}}function getImageFitClass(imageWidth,imageHeight){var containerAspectRatio=imageInner.width()/imageInner.height(),imageAspectRatio=imageWidth/imageHeight,fitClass="image-stretch-vertical";
if(imageAspectRatio>containerAspectRatio){fitClass="image-stretch-horizontal";
}return fitClass;
}function getZoomOptions(selectedId){var options={};
if(images[selectedId]){options.containerId="igInner";
options.imageId="igImage";
options.imageWidth=images[selectedId].dimensions[0];
options.imageHeight=images[selectedId].dimensions[1];
options.DPCL=DPCL;
}return options;
}function bindThumbEvents(){if(images){thumbs.find(".ig-thumb-inner").click(function(){var id=this.id,currObj=$(this),newImageData=images[id];
if(!currObj.hasClass("selected")&&newImageData){changeThumb(currObj);
zoomer.detachEvents();
attachImageOnload();
updateImage(id);
var zoomOptions=getZoomOptions(id);
zoomer.setImageData(zoomOptions);
if(DPCL&&!thumbInteractionLogged){DPCL.logImpression("ma-img-gallery-thumb");
thumbInteractionLogged=1;
}}});
}}function changeThumb(thumbObj){thumbs.find(".selected").removeClass("selected");
thumbObj.addClass("selected");
}function attachImageOnload(){image.addClass("a-hidden");
loadingBar.show();
document.getElementById("igImage").onload=onLoadFn;
}var onLoadFn=function(){loadingBar.hide();
image.removeClass("a-hidden");
zoomer.attachZoomEvents();
};
function ImageZoomer(){var zoomer={},containerId=null,imageId=null,imageWidth=0,imageHeight=0,containerObj=null,imageObj=null,hasXZoom=false,hasYZoom=false,zoomInteractionLogged=0,DPCL;
zoomer.setImageData=function(options){containerId=options.containerId;
imageId=options.imageId;
imageWidth=options.imageWidth;
imageHeight=options.imageHeight;
DPCL=options.DPCL;
containerObj=$("#"+containerId);
imageObj=$("#"+imageId);
hasXZoom=isXZoomable();
hasYZoom=isYZoomable();
};
zoomer.attachZoomEvents=function(){if(hasXZoom||hasYZoom){containerObj.addClass("zoomable");
imageObj.click(function(event){if(DPCL&&typeof DPCL.logImpression=="function"&&!zoomInteractionLogged){DPCL.logImpression("ma-img-gallery-zoom");
zoomInteractionLogged=1;
}if(containerObj.hasClass("zoomed-in")){zoomer.zoomOut();
imageObj.unbind("mousemove");
}else{if(containerObj.hasClass("zoomed-out")){positionImage(event);
imageObj.mousemove(function(event){positionImage(event);
});
}}});
}};
zoomer.zoomIn=function(position){imageObj.css("top",posCordinate(position.y));
imageObj.css("left",posCordinate(position.x));
containerObj.removeClass("zoomed-out").addClass("zoomed-in");
};
zoomer.zoomOut=function(){containerObj.removeClass("zoomed-in").addClass("zoomed-out");
};
zoomer.detachEvents=function(){zoomer.zoomOut();
imageObj.unbind();
containerObj.removeClass("zoomable");
};
function posCordinate(offset){return -1*offset;
}function positionImage(event){var pos=getZoomPosition(event);
zoomer.zoomIn(pos);
}function isXZoomable(){return imageWidth>0&&containerObj.length>0&&imageWidth>containerObj.width();
}function isYZoomable(){return imageHeight>0&&containerObj.length>0&&imageHeight>containerObj.height();
}function getZoomPosition(event){var mouseContainerOffset={},position={},containerWidth=containerObj.width(),containerHeight=containerObj.height();
mouseContainerOffset.x=event.pageX-containerObj.offset().left;
mouseContainerOffset.y=event.pageY-containerObj.offset().top;
if(hasXZoom){position.x=mouseContainerOffset.x*imageWidth/containerWidth-mouseContainerOffset.x;
}else{position.x=0;
}if(hasYZoom){position.y=mouseContainerOffset.y*imageHeight/containerHeight-mouseContainerOffset.y;
}else{position.y=0;
}return position;
}return zoomer;
}});
